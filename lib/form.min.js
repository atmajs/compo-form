"use strict";!function(t,e){var n="undefined"!=typeof global?global:window,r=n.mask||n.atma&&n.atma.mask;if(null==r){if("function"!=typeof require)throw Error("MaskJS was not loaded");mask=require("maskjs")}e(n,r,r.Compo.config.getDOMLibrary())}(void 0,function(t,e,n){var r,o;!function(){o=function(t){return Object.prototype.toString.call(t).replace("[object ").replace("]")},r=function(t,e){var n=void 0===arguments[2]?{}:arguments[2];if(null==t)return n;var o=_getType(t);if("Array"===o)return t.forEach(function(t,o){r(t,e+"["+o+"]",n)}),n;if("Object"===o){e&&(e+=".");var i,a,s;for(i in t)if(a=t[i],s=e+i,null!=a){var o=_getType(a);switch(o){case"Object":case"Array":r(a,s,n);continue;case"String":case"Number":case"Boolean":case"Blob":s in n&&console.warn("ToFormData: Overwrite property",s),n[s]=a;continue;default:console.error("Possible type violation",o),n[s]=a;continue}}return n}switch(o){case"String":case"Number":case"Boolean":case"Blob":break;default:console.error("Possible type violation",o)}return e in n&&console.warn("ToFormData: Overwrite property",e),n[e]=t,n}}();var i;!function(){i=function(t,e){var n=void 0===arguments[2]?"":arguments[2],o=r(e,n);for(var i in o){var a=null,s=o[i];"object"==typeof s&&s.fileName&&(a=s.fileName),null==a?t.append(i,s):t.append(i,s,a)}}}();var a;!function(){a=function(t,n){e.TreeWalker.walk(t,function(e){return e!==t?n(e):void 0})}}();var s;!function(){s=e["class"].create(e["class"].EventEmitter,e["class"].Deferred,{constructor:function(t,e){this.url=t,this.method=e,this.xhr_=null,this.loadPercent=0,this.uploadPercent=0,this.headers={}},write:function(t){return this.data=t,"Object"===o(t)&&(this.data=JSON.stringify(t)),this},writeHeaders:function(t){return e.obj.extend(this.headers,t),this},setEndpoint:function(t,e){return this.url=t,this.method=e,this},isBusy:function(){return null!=this.xhr_},loading_:function(t){this.emit("progress","load",this.loadPercent=t)},uploading_:function(t){this.emit("progress","upload",this.uploadPercent=t)},readResponse_:function(t){var e=this.xhr_,n=e.responseText||"",r=e.getResponseHeader("content-type");if(null==r)return t(Error("Content-Type not set"));if(/json/i.test(r))try{n=JSON.parse(n)}catch(o){return t(Error("Json response malformed: "+String(o)))}return 200===e.status?t(null,n):t(this.toError_(e,n))},toError_:function(t,e){var n=t.status,r=t.responseText||t.statusText;return null!=e&&"object"==typeof e&&(n=e.status||n,r=e.message||e.error||r),new d(r,n)},complete_:function(t,e){return this.loading_(100),this.xhr_=null,t?(this.emit("error",t),void this.reject(t)):(this.emit("complete",e),void this.resolve(e))},send:function(){var t=this;if(this.isBusy())throw Error("Request is not reusable");var e=this.xhr_=new XMLHttpRequest;e.onload=function(){t.readResponse_(function(e,n){return t.complete_(e,n)})},e.upload&&(e.upload.onprogress=function(e){if(e.lengthComputable){var n=(e.loaded,e.total,e.loaded/e.total*100|0);return void t.uploading_(n)}return t.uploadPercent<90?void t.uploading_(t.uploadPercent+10):void t.uploading_(100)}),e.open(this.method,this.url);for(var n in this.headers)e.setRequestHeader(n,this.headers[n]);return this.emit("start"),e.send(this.data),this}})}();var u,l=(e["class"].create({run:function(t){for(var e=this,n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];this.error=null;var i,a=this[t];return r.unshift(this),a.forEach(function(t){e.error||(i=e.perform(t,r))}),i},perform_:function(t,e){var n="string"==typeof t?this[t]:t;try{return n.apply(null,e)}catch(r){this.error=r,this.throw_(r)}},throw_:function(t){throw t}}),e["class"].create(Object.defineProperties({body:null,headers:null,method:"POST",endpoint:window.location.href,contentType:"application/json",constructor:function(t){var e=void 0===arguments[1]?{}:arguments[1];this.body=t,this.headers=e.headers,e.endpoint&&(this.endpoint=e.endpoint),e.method&&(this.method=e.method),e.contenType&&(this.contentType=e.contentType)},serializeHeaders:function(){var t={"Content-Type":this.contentType};return e.obj.extend(t,this.headers)},serialize:function(){return/form-data/i.test(this.contentType)?this.formData:JSON.stringify(this.body)}},{formData:{get:function(){var e=new t.FormData;return i(e,this.body),e},configurable:!0,enumerable:!0}}))),c=e["class"].createError("ValidationError",{constructor:function(t){null!=t&&"object"==typeof t&&(this.message=t.message||t.error||String(t))},message:""}),d=e["class"].createError("HttpError",{status:500,message:"",constructor:function(t,e){this.status=e,this.message=t}});!function(){u={getJson:function(t){return new s(t,"GET").send()},getGetterEndpoint:function(t,e){var n=t.xGet,r="get"===n||n===!0?t.xAction:n;return this.formatEndpoint(r,e)},formatEndpoint:function(n,r){n.replace(t,function(t,n){var r=e.obj.getProperty(body,n);return r?(method=params.methodEdit||formCompo.xMethodEdit,r):""})},upload:function(t){var e=t.endpoint,n=t.method,r=(t.serialize(),new s(e,n));return r.write(t.serialize()).writeHeaders(t.serializeHeaders()).send()}};var t=/\/:([\w\.]+)/}();var p;!function(){p={process:function(t){var e;return a(t,function(t){var n=t.compoName;if((":dualbind"===n||"dualbind"===n)&&(e=t.provider.validate()))return{"break":!0};var r=t.validateUi||t.validate;return null!=r&&(e=r.call(t))?{"break":!0}:void 0}),e}}}();var h;!function(){function t(t){var n=t.model,r=e.obj.extend({},n);return a(t,function(t){var n=t.toJson||t.toJSON;if(n){var o=n.call(t);return e.obj.extend(r,o),{deep:!1}}}),r}h={createMessage:function(e){var n=void 0===arguments[1]?{}:arguments[1],r=t(e),o=n.contentType||e.xContenType,i=n.action||e.xAction,a=n.method||e.xMethod;return i=u.formatEndpoint(i,r),new l(r,{contentType:o,endpoint:i,method:a})}}}();var f=e.Compo({tagName:"form",builder:null,transport:null,model:null,entity:null,meta:{attributes:{"form-type":"","content-type":"application/json",offset:0,method:"POST","method-edit":"PUT",action:window.location.href,get:"",redirect:""},template:"merge"},attr:{style:"position: relative;"},slots:{submit:"submit"},events:{submit:function(t){return t.preventDefault()}},scope:{notificationMsg:"",notificationType:""},submit:function(t){t.preventDefault(),this.upload()},validate:function(){return p.process(this)},activity:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];this.emitIn.apply(this,["formActivity",t].concat(n)),"start"===t&&this.signalState("submit",!1),"end"===t&&this.signalState("submit",!0)},onRenderStart:function(t,e){var n=t||{};return this.model=this.entity=n,this.ensureReflect_(),this.ensureCompo_("Notification"),this.ensureCompo_("Progress"),this.formLayout_(),this.xGet?(this.model=this.entity=null,this.load(u.getGetterEndpoint(this,n))):void 0},setEntity:function(t){return this.entity=t,null==this.model?void(this.model=t):void e.obj.extend(this.model,t)},getEntity:function(){return this.entity||this.model},load:function(t){var e=this;return u.getJson(t).fail(function(t){return e.errored_(t)}).done(function(t){e.activity("end","load",t),e.setModel(t)})},upload:function(){var t=this;if(!this.xhr||!this.xhr.isBusy()){var e=this.validate();if(e)return void this.errored_(new c(e));var n=h.createMessage(this);this.activity("start"),this.xhr=u.upload(n).fail(function(e){return t.errored_(e)}).done(function(e){return t.notify("success","OK"),t.xRedirect?(t.notify("success","OK. Redirecting..."),void(window.location.href=t.xRedirect)):void t.activity("end","upload",e)})}},notify:function(t,e){0===arguments.length&&(t=e=""),this.scope.notificationType=t,this.scope.notificationMsg=e,this.emitIn("formNotification",{type:t,message:e})},ensureCompo_:function(t){var e=jmask(this).children(t);0===e.length&&jmask(this).prepend(t)},ensureReflect_:function(){var t=jmask(this).children();0===t.length&&jmask(this).prepend("Reflect")},formLayout_:function(){var t=this,e="form";this.xFormType&&(e+="-"+this.xFormType,0===this.xOffset&&"horizontal"===this.xFormType&&(this.xOffset=1)),jmask(this).addClass(e).children().each(function(e){return e.attr.offset=t.xOffset})},throw_:function(t){this.nodes=e.parse("\n			div style='background: red; color: white; padding: 15px; font-weight: bold' {\n				\""+t.message+'"\n			}\n		')},errored_:function(t){this.activity("end"),this.activity("error",t),this.notify("danger",t.message||String(t))}}),m="\n	// source Array.mask\n	let Array {\n		\n		function getArray () {\n			return mask.obj.get(this.model, this.attr.property);\n		}\n		\n		slot arrayItemRemove (event) {\n			var model = $(event.target).model(),\n				arr = this.getArray(),\n				i = arr.indexOf(model);\n			arr.splice(i, 1);\n		}\n		\n		slot arrayItemAdd () {\n			var arr = this.getArray(),\n				item = {};\n			arr.push(item);\n		}\n		\n		\n		\n		include ItemLayout {\n			@element {\n				@header;\n				ul.list-unstyled > +each (@attr.property) {\n					li style='position:relative; padding: 0px 15px; box-sizing: border-box;' {\n						@template;\n					}\n				}\n				@footer;\n			}\n		}\n		\n		\n	}\n	\n	// end:source Array.mask\n	// source Checkbox.mask\n	let Checkbox {\n		include ItemLayout {\n			@element {\n				label {\n					input type='checkbox' class='@[attr.class]'>\n						:dualbind value='@attr.property';\n					\n					span > ' @[attr.text]'\n				}\n			}\n		}\n	}\n	// end:source Checkbox.mask\n	// source Input.mask\n	let Input {\n		include ItemLayout {\n			@element {\n				input\n					class = 'form-control @attr.class'\n					type='@[attr.type || \"text\"]'\n					placeholder='@attr.placeholder' >\n					\n						:dualbind value='@attr.property';\n			}\n		}\n	}\n	\n	// end:source Input.mask\n	// source Select.mask\n	let Select {\n		include ItemLayout {\n			@element {			\n				select .form-control {\n					@each (option) > option value='@attr.value' {\n						@placeholder;\n					}\n					dualbind value='@attr.property';\n				}\n			}\n		}\n	}\n	// end:source Select.mask\n	// source Radio.mask\n	let Radio {\n		include ItemLayout {\n			@element {\n				\n				@each (Option) > .radio > label {\n					input type = radio name='@attr.property' value='@attr.value' class='@attr.class' >\n						:dualbind value='@attr.property';\n						\n					@placeholder;\n				}\n				\n			}\n		}\n	}\n	// end:source Radio.mask\n	// source Text.mask\n	let Text {\n		include ItemLayout {\n			@element {\n				textarea .form-control placeholder='@attr.placeholder'  rows='@[attr.rows || 4]' >\n					:dualbind value='@attr.property';\n			}\n		}\n	}\n	// end:source Text.mask\n	// source Notification.mask\n	let Notification {\n		@if (template) {\n			@template;\n		}\n		@else {\n			+if (notificationMsg) {\n				.alert.alert-~[bind: $scope.notificationType] > '~[bind: $scope.notificationMsg ]'\n			}\n		}\n	}\n	// end:source Notification.mask\n	// source Progress.mask\n	let Progress {\n		var value = -1;\n		\n		slot formActivity (sender, type, name, percent) {\n			if (type === 'start') {\n				this.$.fadeIn();\n			}\n			if (type === 'end') {\n				this.$.fadeOut();\n			}\n			if (type !== 'progress') {\n				return;\n			}\n			this.scope.value = percent;\n		}\n		\n		.-a-form-progress {\n			\n			progress value='~[bind: $scope.value == -1 ? null : $scope.value]' max=100;\n			\n			style scoped {\n				:host {\n					background: rgba(0,0,0,.8);\n					position: absolute;\n					top: 0; left: 0; width: 100%; height: 100%;\n					z-index: 999;\n					display: none;\n				}\n				progress {\n					position: absolute;\n					top: 50%;\n					left: 1%;\n					width: 98%;\n				}\n			}\n		}\n	}\n	// end:source Progress.mask\n	// source Template.mask\n	let Template {\n		include ItemLayout {\n			@element > @template;\n		}\n	}\n	// end:source Template.mask\n	// source Hidden.mask\n	input type='hidden' name='@attr.property' >\n		dualbind value='@attr.property';\n	// end:source Hidden.mask\n	// source ItemLayout.mask\n	let ItemLayout {\n		.form-group {\n			\n			label.control-label.col-sm-@[attr.offset] {\n				@label;\n			}\n			\n			.col-sm-@[12-attr.offset] {\n				@element;\n			}\n		}\n	}\n	// end:source ItemLayout.mask\n";e.registerFromTemplate(m,f),e.registerHandler(f,"Reflect",{type:e.Dom.COMPONENT,renderStart:function(){function t(t,e){var n=jmask("@label").text(e.property);return jmask(t).attr(e).append(n)}var e=jmask(this),n=this.model;for(var r in n){var o=n[r];if(null!=o)switch(typeof o){case"string":case"number":e.append(t("Input",{type:typeof o,placeholder:r,property:r}));continue;case"boolean":e.append(t("Checkbox",{property:r,text:r}));continue}}}}),e.registerHandler("a:form",f)});
//# sourceMappingURL=form.min.js.map